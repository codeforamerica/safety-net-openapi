# User schemas for the User Service
#
# These schemas support authentication/authorization, not domain-specific
# staff management. For job function, skills, and workload, see CaseWorker
# in the Case Management domain (future).
#
# Schemas in this file:
#   Primary:
#     - User                    User account with role and permissions
#
#   Supporting (alphabetical):
#     - FrontendAuthContext     Extended auth context for frontend tokens
#     - UiPermissions           Computed UI permissions for frontend
#     - UserPreferences         User preferences
#     - UserStatus              User account status
#
# Shared schemas (in common.yaml):
#     - BackendAuthContext      Minimal claims for backend API authorization
#     - JwtClaims               Full JWT structure for domain APIs
#     - RoleType                Available authorization roles

FrontendAuthContext:
  type: object
  description: |
    Authorization context for frontend applications. Extends BackendAuthContext
    with display name, UI permissions, and user preferences.

    Used in enriched JWTs for frontends (via BFF/gateway) or returned by
    GET /users/me. States can customize this independently from BackendAuthContext.
  allOf:
    - $ref: "./common.yaml#/BackendAuthContext"
    - type: object
      properties:
        name:
          type: string
          description: User's display name.
          example: "Jane Smith"
        ui:
          $ref: "#/UiPermissions"
        preferences:
          $ref: "#/UserPreferences"

User:
  description: |
    User account for authentication and authorization. Links an IdP identity
    to roles, permissions, and county assignments.

    Note: Job function details (skills, team, workload) are not stored here.
    Staff users link to a CaseWorker record in the Case Management domain.
  allOf:
    - $ref: "#/FrontendAuthContext"
    - type: object
      required:
        - id
        - idpSubject
        - email
        - status
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          format: uuid
          readOnly: true
          description: Unique identifier for the user (same as userId in JWT claims).
        idpSubject:
          type: string
          description: |
            Subject identifier from the Identity Provider. Immutable after creation.
            Format varies by IdP (e.g., "auth0|507f1f77bcf86cd799439011").
          example: "auth0|507f1f77bcf86cd799439011"
        email:
          type: string
          format: email
          description: User's email address (from IdP or manually set).
          example: "jane.smith@alameda.gov"
        status:
          $ref: "#/UserStatus"
        createdAt:
          type: string
          format: date-time
          readOnly: true
          description: Timestamp when the user was created.
        updatedAt:
          type: string
          format: date-time
          readOnly: true
          description: Timestamp when the user was last updated.

# Supporting schemas (alphabetical)

UiPermissions:
  type: object
  readOnly: true
  description: |
    Computed UI permissions for frontend feature toggling.
    Backend computes these from role and permissions to provide
    a UI-friendly interface for showing/hiding features.
  properties:
    availableModules:
      type: array
      items:
        type: string
        enum:
          - cases
          - tasks
          - reports
          - documents
          - scheduling
          - admin
      description: Modules the user can access in the UI.
      example:
        - cases
        - tasks
        - documents
    canApproveApplications:
      type: boolean
      description: Can approve/deny applications.
    canViewSensitivePII:
      type: boolean
      description: Can view unmasked SSN and other sensitive data.
    canExportData:
      type: boolean
      description: Can export bulk data.
    canManageUsers:
      type: boolean
      description: Can create/modify user accounts.
    canImpersonate:
      type: boolean
      description: Can act on behalf of another user.

UserPreferences:
  type: object
  description: User preferences for the application.
  properties:
    timezone:
      type: string
      description: User's preferred timezone (IANA format).
      example: "America/Los_Angeles"
    dateFormat:
      type: string
      enum:
        - iso
        - us
        - eu
      default: us
      description: Preferred date display format.
    itemsPerPage:
      type: integer
      minimum: 10
      maximum: 100
      default: 25
      description: Default pagination size.

UserStatus:
  type: string
  description: User account status.
  enum:
    - active
    - inactive
    - pending
    - suspended
