# Common shared components and schemas
#
# This file contains schemas shared across multiple APIs.
#
# Schemas in this file:
#   Identity/Contact:
#     - Address, Email, Name, PhoneNumber, SocialSecurityNumber
#
#   Authentication/Authorization:
#     - BackendAuthContext     Minimal claims for backend API authorization
#     - JwtClaims              Full JWT structure (standard + authorization claims)
#     - RoleType               Available authorization roles
#
#   Domain:
#     - EmployerInfo, Language, Program, Signature

Address:
  type: object
  description: Residential or mailing address used to determine eligibility.
  additionalProperties: false
  required:
  - addressLine1
  - city
  - stateProvince
  - postalCode
  properties:
    addressLine1:
      type: string
      description: Primary street address line.
      minLength: 1
      maxLength: 150
    addressLine2:
      type: string
      description: Secondary address line such as apartment or unit.
      maxLength: 150
    city:
      type: string
      description: City or locality of residence.
      minLength: 1
      maxLength: 100
    stateProvince:
      type: string
      description: State, province, or region of residence.
      minLength: 1
      maxLength: 100
    postalCode:
      type: string
      description: Postal or ZIP code.
      minLength: 3
      maxLength: 20
    county:
      type: string
      description: County or equivalent administrative region.
      maxLength: 100

BackendAuthContext:
  type: object
  description: |
    Minimal authorization context for backend API authorization. Stored in the
    User Service and embedded in JWT tokens during login. Domain APIs read these
    claims for authorization decisions without runtime calls to the User Service.

    For frontend tokens that include UI permissions and preferences, see
    FrontendAuthContext in user.yaml.
  required:
    - userId
    - roleAssignments
  properties:
    userId:
      type: string
      format: uuid
      description: User Service identifier.
    roleAssignments:
      $ref: "#/RoleAssignments"

RoleAssignments:
  type: object
  description: Role and permissions for authorization.
  required:
    - role
  properties:
    role:
      $ref: "#/RoleType"
    permissions:
      type: array
      items:
        type: string
      description: |
        Permission strings in the format {resource}:{action}.
        Examples: applications:read, persons:update, users:create
      example:
        - "applications:read"
        - "applications:create"
        - "persons:read"

Email:
  type: string
  format: email
  description: Email address.
  maxLength: 320

EmployerInfo:
  type: object
  description: Employer identification and contact information.
  additionalProperties: false
  properties:
    name:
      type: string
      description: Employer or business name.
      maxLength: 200
    phone:
      $ref: "#/PhoneNumber"
      description: Employer phone number.
    address:
      $ref: "#/Address"
      description: Employer address.
    identificationNumber:
      type: string
      description: Employer Identification Number (EIN).
      maxLength: 50

JwtClaims:
  type: object
  description: |
    Expected JWT claims structure for domain API authentication.
    Combines standard JWT claims with custom authorization claims.

    Domain APIs validate the JWT signature and read these claims
    for authorization decisions. No runtime calls to User Service required.
  required:
    - sub
    - iss
    - aud
    - exp
    - userId
    - roleAssignments
  allOf:
    - type: object
      properties:
        # Standard JWT claims (RFC 7519)
        sub:
          type: string
          description: |
            Subject identifier from the Identity Provider.
            Uniquely identifies the user within the IdP.
          example: "auth0|507f1f77bcf86cd799439011"
        iss:
          type: string
          format: uri
          description: Token issuer (IdP URL).
          example: "https://your-tenant.auth0.com/"
        aud:
          type: string
          description: Intended audience (API identifier).
          example: "https://api.safetynet.example.com"
        exp:
          type: integer
          description: Expiration timestamp (Unix epoch seconds).
          example: 1706300000
        iat:
          type: integer
          description: Issued-at timestamp (Unix epoch seconds).
          example: 1706296400
        # Identity claims
        email:
          type: string
          format: email
          description: User's email address.
          example: "jane.smith@alameda.gov"
        name:
          type: string
          description: User's display name.
          example: "Jane Smith"
    # Authorization context
    - $ref: "#/BackendAuthContext"

PhoneNumber:
  type: string
  description: Phone number in international or local format.
  pattern: "^\\+?[0-9 .\\-()]{7,20}$"

Name:
  type: object
  description: Legal name of a person.
  additionalProperties: false
  required:
  - firstName
  - lastName
  properties:
    firstName:
      type: string
      description: First name.
      minLength: 1
      maxLength: 100
    middleInitial:
      type: string
      description: Middle initial.
      maxLength: 1
    middleName:
      type: string
      description: Middle name.
      maxLength: 100
    lastName:
      type: string
      description: Last name.
      minLength: 1
      maxLength: 100
    maidenName:
      type: string
      description: Maiden name if applicable.
      maxLength: 100
    suffix:
      type: string
      description: Name suffix such as Jr., Sr., III, etc.
      maxLength: 20

Program:
  type: string
  description: Public assistance program type.
  enum:
    - snap
    - tanf
    - adult_financial
    - medical_assistance

RoleType:
  type: string
  description: |
    Authorization roles that determine base permissions and data scoping.

    - applicant: Self-service access to own applications (scoped by personId)
    - case_worker: Process applications for assigned county
    - supervisor: Oversee case workers, approve determinations (may span counties)
    - county_admin: Administer county staff and configuration
    - state_admin: Statewide oversight and administration (all counties)
    - partner_readonly: External partner with limited read access
  enum:
    - applicant
    - case_worker
    - supervisor
    - county_admin
    - state_admin
    - partner_readonly

Signature:
  type: object
  description: Signature with name and date.
  additionalProperties: false
  required:
  - signature
  - signatureDate
  properties:
    signature:
      type: string
      description: Signature or signature indicator.
    signatureDate:
      type: string
      format: date
      description: Date the signature was made.

SocialSecurityNumber:
  type: string
  description: Social Security Number for identity verification.
  pattern: "^\\d{3}-\\d{2}-\\d{4}$"

Language:
  type: string
  description: Preferred language (BCP 47 language tag).
  pattern: "^[a-zA-Z]{2,3}(?:-[a-zA-Z0-9]{2,8})*$"

