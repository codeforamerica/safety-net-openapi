overlay: 1.0.0
info:
  title: California State Overlay
  version: 1.0.0
  description: |
    California-specific modifications to the base Safety Net API schemas.
    Includes state program names, additional fields required by California
    regulations, and terminology adjustments.

actions:
  # ============================================================================
  # Person Schema Modifications (components/person.yaml)
  # These target the standalone component file structure
  # ============================================================================

  # California uses different terminology for citizenship status
  # CitizenshipInfo is now a container schema, making it easier to target
  - target: $.CitizenshipInfo.properties.status.enum
    description: California uses USCIS-aligned terminology
    update:
      - us_citizen
      - lawful_permanent_resident
      - qualified_alien
      - prucol
      - undocumented
      - other

  # California tracks additional gender options per state law (separate from biological sex)
  - target: $.DemographicInfo.properties
    description: California Gender Recognition Act compliance
    update:
      gender:
        type: string
        description: Gender identity per California Gender Recognition Act (SB 179).
        enum:
          - male
          - female
          - nonbinary
          - unknown

  # Add California-specific county code field
  - target: $.Person.allOf.1.properties
    description: Add California county tracking
    update:
      countyCode:
        type: string
        description: California county code (01-58) for benefit administration.
        pattern: "^[0-5][0-9]$"
        example: "19"
      countyName:
        type: string
        description: California county name.
        enum:
          - Alameda
          - Alpine
          - Amador
          - Butte
          - Calaveras
          - Colusa
          - Contra Costa
          - Del Norte
          - El Dorado
          - Fresno
          - Glenn
          - Humboldt
          - Imperial
          - Inyo
          - Kern
          - Kings
          - Lake
          - Lassen
          - Los Angeles
          - Madera
          - Marin
          - Mariposa
          - Mendocino
          - Merced
          - Modoc
          - Mono
          - Monterey
          - Napa
          - Nevada
          - Orange
          - Placer
          - Plumas
          - Riverside
          - Sacramento
          - San Benito
          - San Bernardino
          - San Diego
          - San Francisco
          - San Joaquin
          - San Luis Obispo
          - San Mateo
          - Santa Barbara
          - Santa Clara
          - Santa Cruz
          - Shasta
          - Sierra
          - Siskiyou
          - Solano
          - Sonoma
          - Stanislaus
          - Sutter
          - Tehama
          - Trinity
          - Tulare
          - Tuolumne
          - Ventura
          - Yolo
          - Yuba
        example: "Los Angeles"
      calworksEligible:
        type: boolean
        description: Indicates eligibility for California Work Opportunity and Responsibility to Kids (CalWORKs).
      calfreshEligible:
        type: boolean
        description: Indicates eligibility for CalFresh (California SNAP).
      medicalEligible:
        type: boolean
        description: Indicates eligibility for Medi-Cal.

  # ============================================================================
  # Application Schema Modifications (components/application.yaml)
  # These target HouseholdMember which extends Person with application fields
  # ============================================================================

  # California program names
  - target: $.Program.enum
    description: California uses branded program names
    update:
      - calfresh
      - calworks
      - medi_cal
      - calfresh_healthy_living
      - general_assistance
      - capi
      - ihss

  # ============================================================================
  # User/Auth Schema Modifications (components/user.yaml, components/common.yaml)
  # ============================================================================

  # California uses base role terminology (case_worker, supervisor, etc.)
  # No changes needed to RoleType enum

  # Add CalSAWS integration module to UiPermissions
  - target: $.UiPermissions.properties.availableModules.items.enum
    file: components/user.yaml
    description: California includes CalSAWS integration module
    update:
      - cases
      - tasks
      - reports
      - documents
      - scheduling
      - admin
      - calsaws_integration

  # Add programs to User for program-based assignments (optional in CA)
  - target: $.User.allOf.1.properties
    file: components/user.yaml
    description: California supports optional program-based assignments
    update:
      programs:
        type: array
        items:
          $ref: "./common.yaml#/Program"
        description: |
          Programs the user is authorized to work on.
          Optional in California; if empty, user can access all programs
          within their assigned counties.
        example: ["calfresh", "calworks"]

  # Add programs to BackendAuthContext (for JWT)
  - target: $.BackendAuthContext.properties
    file: components/common.yaml
    description: California JWT claims may include programs
    update:
      programs:
        type: array
        items:
          type: string
        description: Programs the user is authorized to access (empty = all programs).
        example: ["calfresh", "calworks"]
