# Work in progress: Income Item schema using discriminator-based inheritance
# IncomeItemBase is the polymorphic base type; concrete types inherit via allOf

VerificationSource:
  description: A source of verification, which may be an external API or document.
  properties:
    id:
      type: string
      format: uuid
      description: Unique identifier for the verification source.
      readOnly: true

IncomeItemBase:
  type: object
  description: Base type for all income items. Use the 'type' field to determine the specific income type and available properties.
  required:
    - personId
    - type
    - amount
    - frequency
    - reportedOn
    - source
    - startDate
  discriminator:
    propertyName: type
    mapping:
      employed: '#/EmployedEarnedIncomeItem'
      self_employed: '#/SelfEmployedEarnedIncomeItem'
      unearned: '#/UnearnedIncomeItem'
  properties:
    id:
      type: string
      format: uuid
      description: Unique identifier for the income item.
      readOnly: true
    personId:
      type: string
      format: uuid
      description: Foreign key reference to the person who has this income.
    type:
      type: string
      description: The type of income this item represents. Used as discriminator.
      enum:
        - employed
        - self_employed
        - unearned
    incomeBasis:
      type: string
      description: Whether the income is net or gross.
      enum:
        - net
        - gross
    amount:
      type: number
      format: float
      description: The amount of income this item represents.
    frequency:
      type: string
      description: The frequency with which the income is received.
      enum:
        - hourly
        - daily
        - weekly
        - every_2_weeks
        - twice_a_month
        - monthly
        - yearly
    reportedOn:
      type: string
      format: date
      description: The date the income was reported on.
    source:
      type: string
      description: The source of the income item.
      enum:
        - client
        - authorized_assister
        - county_worker
    startDate:
      type: string
      format: date
      description: When did the applicant first receive this income?
    endDate:
      type: string
      format: date
      description: Does applicant expect this income to end soon or has it already ended?
    isVerified:
      type: boolean
      description: Whether the income has been verified.
    verifiedDate:
      type: string
      format: date
      description: The date the income was verified.
    verifiedBy:
      type: string
      format: uuid
      description: The county worker who verified the income.
    verificationSourceIds:
      type: array
      description: Array of verification sources related to this income.
      items:
        type: string
        format: uuid

EmployedEarnedIncomeItem:
  description: Income from employment.
  required:
    - employerId
    - seasonalOrTemporary
    - tipsOrCommission
    - didStrike
  allOf:
    - $ref: '#/IncomeItemBase'
    - type: object
      properties:
        employerId:
          type: string
          format: uuid
          description: The employer related to this earned income.
        averageHoursPerWeek:
          type: number
          format: float
          description: Average hours worked each week
          minimum: 0
          maximum: 168
        temporary:
          type: boolean
          description: Is the job considered temporary, lasting less than three months?
        seasonal:
          type: boolean
          description: Is the job considered seasonal?
        tipsOrCommission:
          type: boolean
          description: Is the job tip or commission-based?
        didStrike:
          type: boolean
          description: Did the applicant go on strike during this employment?

SelfEmployedEarnedIncomeItem:
  description: Income from self-employment.
  required:
    - employerId
    - typeOfSelfEmployment
  allOf:
    - $ref: '#/IncomeItemBase'
    - type: object
      properties:
        employerId:
          type: string
          format: uuid
          description: The employer related to this earned income.
        oneMonthsGrossIncome:
          type: number
          format: float
          description: One month's gross income
          minimum: 0
        typeOfSelfEmployment:
          type: array
          description: Type of self-employment
          items:
            type: string
            enum:
              - sole_proprietor
              - llc
              - s_corp
              - independent_contractor
        utilitiesPaidForBusiness:
          type: number
          format: float
          description: Utilities paid for business
          minimum: 0
        businessTaxesPaid:
          type: number
          format: float
          description: Business taxes paid
          minimum: 0
        interestPaidForBusiness:
          type: number
          format: float
          description: Interest paid for business
          minimum: 0
        grossBusinessLaborCosts:
          type: number
          format: float
          description: Gross business labor costs
          minimum: 0
        costOfMerchandise:
          type: number
          format: float
          description: Cost of merchandise
          minimum: 0
        otherBusinessCosts:
          type: array
          description: Other business costs
          items:
            type: object
            properties:
              type:
                type: string
                description: Type
                maxLength: 100
              amount:
                type: number
                format: float
                description: Cost amount
                minimum: 0
        totalNetIncome:
          type: number
          format: float
          description: Total Net Income (Subtract your expenses from your gross income)
          minimum: 0

UnearnedIncomeItem:
  description: Income from an unearned source. Use the 'typeOfUnearnedIncome' field to determine the specific unearned income type.
  required:
    - typeOfUnearnedIncome
  allOf:
    - $ref: '#/IncomeItemBase'
    - type: object
      discriminator:
        propertyName: typeOfUnearnedIncome
        mapping:
          unemployment: '#/UnemploymentIncomeItem'
          kinship_payment: '#/KinshipPaymentIncomeItem'
          veterans_programs: '#/VeteransProgramsIncomeItem'
          adoption_and_refugee_services: '#/AdoptionAndRefugeeServicesIncomeItem'
          ssi_or_ssdi: '#/SsiOrSsdiIncomeItem'
          private_disability: '#/PrivateDisabilityIncomeItem'
          workers_compensation: '#/WorkersCompensationIncomeItem'
          disability_from_veterans_programs: '#/DisabilityFromVeteransProgramsIncomeItem'
          legal_form_or_settlement: '#/LegalFormOrSettlementIncomeItem'
          scholarship: '#/ScholarshipIncomeItem'
          educational_grant: '#/EducationalGrantIncomeItem'
          work_study: '#/WorkStudyIncomeItem'
          spousal_support: '#/SpousalSupportIncomeItem'
          child_support: '#/ChildSupportIncomeItem'
          retirement_or_pension_plan: '#/RetirementOrPensionPlanIncomeItem'
          investment_interest_and_dividends: '#/InvestmentInterestAndDividendsIncomeItem'
          social_security_retirement: '#/SocialSecurityRetirementIncomeItem'
          renting_home: '#/RentingHomeIncomeItem'
          renting_room: '#/RentingRoomIncomeItem'
          renting_equipment: '#/RentingEquipmentIncomeItem'
          gambling_lottery_or_other_winnings: '#/GamblingLotteryOrOtherWinningsIncomeItem'
          donations_or_gifts: '#/DonationsOrGiftsIncomeItem'
          income_from_loan_or_mortgage: '#/IncomeFromLoanOrMortgageIncomeItem'
          payment_for_participating_in_research: '#/PaymentForParticipatingInResearchIncomeItem'
          other_money_not_reported: '#/OtherMoneyNotReportedIncomeItem'
      properties:
        typeOfUnearnedIncome:
          type: string
          description: The type of unearned income. Used as discriminator.
          enum:
            - unemployment
            - kinship_payment
            - veterans_programs
            - adoption_and_refugee_services
            - ssi_or_ssdi
            - private_disability
            - workers_compensation
            - disability_from_veterans_programs
            - legal_form_or_settlement
            - scholarship
            - educational_grant
            - work_study
            - spousal_support
            - child_support
            - retirement_or_pension_plan
            - investment_interest_and_dividends
            - social_security_retirement
            - renting_home
            - renting_room
            - renting_equipment
            - gambling_lottery_or_other_winnings
            - donations_or_gifts
            - income_from_loan_or_mortgage
            - payment_for_participating_in_research
            - other_money_not_reported

# Base unearned income items for inheritance.

VeteransIncomeItemBase:
  description: Base type for veterans-related income. Contains common fields for all veterans income types.
  required: veteransIncomeType
  allOf:
    - $ref: '#/UnearnedIncomeItem'
    - type: object
      properties:
        veteransIncomeType:
          type: str
          description: Type of veterans income
          enum:
            - veterans_100_percent_disability
            - veterans_90_percent_old_pensions
            - veterans_aid_and_attendance
            - veterans_compensation
            - veterans_new_improved_pensions
            - veterans_partial_disability

EducationIncomeItemBase:
  description: Base type for education-related income. Contains common fields for all education income types.
  required:
    - educationId
  allOf:
    - $ref: '#/UnearnedIncomeItem'
    - type: object
      properties:
        educationId:
          type: str
          format: uuid
          description: The related education information.
        highschoolGraduationStatus:
          type: str
          description: Did the applicant graduate from high school?
          enum:
            - ged_or_highschool_equivalency
            - graduated
            - has_not_graduated
        isForEducationExpensesOnly:
          type: boolean
          description: Is this money for education expenses only.

SocialSecurityIncomeItemBase:
  description: Base type for Social Security-related income. Contains common fields for all Social Security income types.
  allOf:
    - $ref: '#/UnearnedIncomeItem'
    - type: object
      properties:
        claimNumber:
          type: str
          description: Claim number
        ssiApplicationDate:
          type: string
          format: date
          description: What is the date of the SSI application? (If you don't know the exact date, you can estimate.)
        ssiApplicationStatus:
          type: str
          description: What is the status of the SSI application?
          enum:
            - pending
            - approved
            - denied
            - appealed

# Concrete unearned income.

UnemploymentIncomeItem:
  description: Income from unemployment benefits.
  required:
    - unemploymentType
  allOf:
    - $ref: '#/UnearnedIncomeItem'
    - type: object
      properties:
        unemploymentType:
          type: str
          enum:
            - tbd
        expectsIncomeToEndSoon:
          type: boolean
          description: Does applicant expect this income to end soon or has it already ended?

KinshipPaymentIncomeItem:
  description: Income from kinship payments.
  required:
    - kinshipPaymentType
  allOf:
    - $ref: '#/UnearnedIncomeItem'
    - type: object
      properties:
        kinshipPaymentType:
          type: str
          enum:
            - tbd

VeteransProgramsIncomeItem:
  description: Income from veterans programs.
  allOf:
    - $ref: '#/VeteransIncomeItemBase'
    - type: object

AdoptionAndRefugeeServicesIncomeItem:
  description: Income from adoption and refugee services.
  required:
    - adoptionAndRefugeeServicesType
  allOf:
    - $ref: '#/UnearnedIncomeItem'
    - type: object
      properties:
        adoptionAndRefugeeServicesType:
          type: str
          enum:
            - tbd

SsiOrSsdiIncomeItem:
  description: Income from SSI or SSDI.
  required:
    - ssiOrSsdiType
  allOf:
    - $ref: '#/SocialSecurityIncomeItemBase'
    - type: object
      properties:
        # @todo this could possibly move to SocialSecurityIncomeItemBase.
        ssiOrSsdiType:
          type: str
          enum:
            - tbd

PrivateDisabilityIncomeItem:
  description: Income from private disability insurance.
  required:
    - privateDisabilityType
  allOf:
    - $ref: '#/UnearnedIncomeItem'
    - type: object
      properties:
        privateDisabilityType:
          type: str
          enum:
            - tbd

WorkersCompensationIncomeItem:
  description: Income from workers compensation.
  required:
    - workersCompensationType
  allOf:
    - $ref: '#/UnearnedIncomeItem'
    - type: object
      properties:
        workersCompensationType:
          type: str
          enum:
            - tbd

DisabilityFromVeteransProgramsIncomeItem:
  description: Income from disability benefits through veterans programs.
  allOf:
    - $ref: '#/VeteransIncomeItemBase'
    - type: object

LegalFormOrSettlementIncomeItem:
  description: Income from legal forms or settlements.
  required:
    - legalFormOrSettlementType
  allOf:
    - $ref: '#/UnearnedIncomeItem'
    - type: object
      properties:
        legalFormOrSettlementType:
          type: str
          enum:
            - tbd

ScholarshipIncomeItem:
  description: Income from scholarships.
  required:
    - scholarshipType
  allOf:
    - $ref: '#/EducationIncomeItemBase'
    - type: object
      properties:
        scholarshipType:
          type: str
          enum:
            - tbd

EducationalGrantIncomeItem:
  description: Income from educational grants.
  required:
    - educationalGrantType
  allOf:
    - $ref: '#/EducationIncomeItemBase'
    - type: object
      properties:
        educationalGrantType:
          type: str
          enum:
            - tbd


WorkStudyIncomeItem:
  description: Income from work study programs.
  required:
    - workStudyType
  allOf:
    - $ref: '#/EducationIncomeItemBase'
    - type: object
      properties:
        workStudyType:
          type: str
          enum:
            - tbd

SpousalSupportIncomeItem:
  description: Income from spousal support or alimony.
  required:
    - spousalSupportType
  allOf:
    - $ref: '#/UnearnedIncomeItem'
    - type: object

ChildSupportIncomeItem:
  description: Income from child support.
  required:
    - childSupportType
  allOf:
    - $ref: '#/UnearnedIncomeItem'
    - type: object

RetirementOrPensionPlanIncomeItem:
  description: Income from retirement or pension plans.
  required:
    - retirementOrPensionPlanType
  allOf:
    - $ref: '#/UnearnedIncomeItem'
    - type: object
      properties:
        retirementOrPensionPlanType:
          type: str
          enum:
            - tbd

InvestmentInterestAndDividendsIncomeItem:
  description: Income from investments, interest, and dividends.
  required:
    - investmentInterestAndDividendsType
  allOf:
    - $ref: '#/UnearnedIncomeItem'
    - type: object
      properties:
        investmentInterestAndDividendsType:
          type: str
          enum:
            - tbd

SocialSecurityRetirementIncomeItem:
  description: Income from Social Security retirement benefits.
  required:
    - socialSecurityRetirementType
  allOf:
    - $ref: '#/SocialSecurityIncomeItemBase'
    - type: object
      properties:
        # @todo this could possibly move to SocialSecurityIncomeItemBase.
        socialSecurityRetirementType:
          type: str
          enum:
            - tbd

# @todo actively refine these three.

RentingHomeIncomeItem:
  description: Income from renting a home.
  required:
    - rentingHomeType
  allOf:
    - $ref: '#/UnearnedIncomeItem'
    - type: object
      properties:
        propertyId:
          type: str
          format: uuid
          description: The property where the rental income originates.
        maintenanceExceeds20HoursWeekly:
          type: boolean
          description: Does maintenance of the property exceeds 20 hours a week?

RentingRoomIncomeItem:
  description: Income from renting a room.
  required:
    - rentingRoomType
  allOf:
    - $ref: '#/UnearnedIncomeItem'
    - type: object
      properties:
        rentingRoomType:
          type: str
          enum:
            - tbd
        tenantPersonId:
          type: str
          format: uuid
          description: What is the name of applicant's tenant?
        numberOfRoomsRented:
          type: integer
          description: How many rooms does applicant's tenant rent?
          minimum: 0

RentingEquipmentIncomeItem:
  description: Income from renting equipment.
  required:
    - rentingEquipmentType
  allOf:
    - $ref: '#/UnearnedIncomeItem'
    - type: object
      properties:
        rentingEquipmentType:
          type: str
          enum:
            - tbd

GamblingLotteryOrOtherWinningsIncomeItem:
  description: Income from gambling, lottery, or other winnings.
  required:
    - gamblingLotteryOrOtherWinningsType
  allOf:
    - $ref: '#/UnearnedIncomeItem'
    - type: object
      properties:
        gamblingLotteryOrOtherWinningsType:
          type: str
          enum:
            - tbd

DonationsOrGiftsIncomeItem:
  description: Income from donations or gifts.
  required:
    - donationsOrGiftsType
  allOf:
    - $ref: '#/UnearnedIncomeItem'
    - type: object
      properties:
        donationsOrGiftsType:
          type: str
          enum:
            - tbd

IncomeFromLoanOrMortgageIncomeItem:
  description: Income from loans or mortgages.
  required:
    - incomeFromLoanOrMortgageType
  allOf:
    - $ref: '#/UnearnedIncomeItem'
    - type: object
      properties:
        incomeFromLoanOrMortgageType:
          type: str
          enum:
            - tbd

PaymentForParticipatingInResearchIncomeItem:
  description: Income from participating in research studies.
  required:
    - paymentForParticipatingInResearchType
  allOf:
    - $ref: '#/UnearnedIncomeItem'
    - type: object
      properties:
        paymentForParticipatingInResearchType:
          type: str
          enum:
            - tbd

OtherMoneyNotReportedIncomeItem:
  description: Other income not reported in other categories.
  required:
    - otherMoneyNotReportedType
  allOf:
    - $ref: '#/UnearnedIncomeItem'
    - type: object
      properties:
        otherMoneyNotReportedType:
          type: str
          enum:
            - tbd
